{"version":3,"sources":["../../../../src/build/webpack/loaders/next-flight-client-module-loader.ts"],"sourcesContent":["import type { webpack } from 'next/dist/compiled/webpack/webpack'\nimport { getRSCModuleInformation } from '../../analysis/get-page-static-info'\nimport { getModuleBuildInfo } from './get-module-build-info'\n\nconst flightClientModuleLoader: webpack.LoaderDefinitionFunction =\n  function transformSource(this, source: string, sourceMap: any) {\n    // Avoid buffer to be consumed\n    if (typeof source !== 'string') {\n      throw new Error('Expected source to have been transformed to a string.')\n    }\n\n    if (!this._module) {\n      return source\n    }\n    // Assign the RSC meta information to buildInfo.\n    const buildInfo = getModuleBuildInfo(this._module)\n    buildInfo.rsc = getRSCModuleInformation(source, false)\n\n    // This is a server action entry module in the client layer. We need to create\n    // re-exports of \"virtual modules\" to expose the reference IDs to the client\n    // separately so they won't be always in the same one module which is not\n    // splittable.\n    if (buildInfo.rsc.actionIds) {\n      return Object.entries(buildInfo.rsc.actionIds)\n        .map(([id, name]) => {\n          return `export { ${name} } from 'next-flight-server-reference-proxy-loader?id=${id}&name=${name}!'`\n        })\n        .join('\\n')\n    }\n\n    return this.callback(null, source, sourceMap)\n  }\n\nexport default flightClientModuleLoader\n"],"names":["flightClientModuleLoader","transformSource","source","sourceMap","Error","_module","buildInfo","getModuleBuildInfo","rsc","getRSCModuleInformation","actionIds","Object","entries","map","id","name","join","callback"],"mappings":";;;;+BAiCA;;;eAAA;;;mCAhCwC;oCACL;AAEnC,MAAMA,2BACJ,SAASC,gBAAsBC,MAAc,EAAEC,SAAc;IAC3D,8BAA8B;IAC9B,IAAI,OAAOD,WAAW,UAAU;QAC9B,MAAM,IAAIE,MAAM;IAClB;IAEA,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;QACjB,OAAOH;IACT;IACA,gDAAgD;IAChD,MAAMI,YAAYC,IAAAA,sCAAkB,EAAC,IAAI,CAACF,OAAO;IACjDC,UAAUE,GAAG,GAAGC,IAAAA,0CAAuB,EAACP,QAAQ;IAEhD,8EAA8E;IAC9E,4EAA4E;IAC5E,yEAAyE;IACzE,cAAc;IACd,IAAII,UAAUE,GAAG,CAACE,SAAS,EAAE;QAC3B,OAAOC,OAAOC,OAAO,CAACN,UAAUE,GAAG,CAACE,SAAS,EAC1CG,GAAG,CAAC,CAAC,CAACC,IAAIC,KAAK;YACd,OAAO,CAAC,SAAS,EAAEA,KAAK,sDAAsD,EAAED,GAAG,MAAM,EAAEC,KAAK,EAAE,CAAC;QACrG,GACCC,IAAI,CAAC;IACV;IAEA,OAAO,IAAI,CAACC,QAAQ,CAAC,MAAMf,QAAQC;AACrC;MAEF,WAAeH"}